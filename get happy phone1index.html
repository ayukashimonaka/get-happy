<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- ã‚¹ãƒãƒ›ç”¨ã«ç”»é¢ã‚µã‚¤ã‚ºã‚’å›ºå®šã—ã€æ‹¡å¤§ç¸®å°ã‚’ç¦æ­¢ã™ã‚‹è¨­å®š -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xmas Game Mobile</title>
    <style>
        body {
            margin: 0; padding: 0;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            height: 100vh; overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
            font-family: 'Arial Black', sans-serif;
            user-select: none; color: white;
            /* ã‚¹ãƒãƒ›ã§ã®ã‚¿ãƒƒãƒæ“ä½œã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„ã‚ºãƒ¼ãƒ ã‚’é˜²ã */
            touch-action: none;
            -webkit-touch-callout: none;
        }

        /* --- ä¸Šéƒ¨ï¼šãƒ„ãƒªãƒ¼ã‚¨ãƒªã‚¢ --- */
        .top-area {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 30%;
            pointer-events: none; /* ã‚¿ãƒƒãƒã‚’é€é */
            z-index: 5;
        }

        .tree-container {
            position: absolute;
            top: 40%; left: 50%;
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        /* ãƒ„ãƒªãƒ¼æç”» */
        .star { width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent; border-bottom:20px solid #ffd700; position:absolute; top:-20px; left:50%; transform:translateX(-50%); filter:drop-shadow(0 0 10px #ffd700); }
        .tree-layer { width:0; height:0; border-left:solid transparent; border-right:solid transparent; border-bottom:solid #0f5132; position:absolute; left:50%; transform:translateX(-50%); }
        .layer-1 { border-width:0 30px 40px 30px; top:0; z-index:3; border-bottom-color:#198754; }
        .layer-2 { border-width:0 50px 60px 50px; top:25px; z-index:2; border-bottom-color:#146c43; }
        .layer-3 { border-width:0 70px 80px 70px; top:60px; z-index:1; border-bottom-color:#0f5132; }
        .trunk { width:20px; height:40px; background-color:#5d4037; position:absolute; top:140px; left:50%; transform:translateX(-50%); }
        .tree-wrapper { position:relative; width:140px; height:180px; }

        /* --- ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ --- */
        .present {
            position: fixed;
            z-index: 50;
            font-size: 40px; /* ã‚¹ãƒãƒ›ã§è¦‹ã‚„ã™ã„ã‚ˆã†ã«å¤§ãã */
            pointer-events: none;
            will-change: top;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }

        /* --- ä¸‹éƒ¨ï¼šæ“ä½œã‚¨ãƒªã‚¢ --- */
        .game-area {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 70%;
            z-index: 10;
        }

        /* èµ¤ã„é´ä¸‹ (CSSæç”») */
        .sock-container {
            position: absolute;
            bottom: 40px; /* è¦ªæŒ‡ã¨ã‹ã¶ã‚‰ãªã„ã‚ˆã†å°‘ã—ä¸Š */
            left: 50%;
            width: 70px;
            height: 110px;
            z-index: 100;
            transform: translateX(-35px); /* ä¸­å¿ƒåˆã‚ã› */
            pointer-events: none;
        }
        .sock-body { position: absolute; bottom: 25px; left: 0; width: 55px; height: 85px; background-color: #d32f2f; border-radius: 0 0 25px 25px; }
        .sock-foot { position: absolute; bottom: 25px; left: 25px; width: 55px; height: 45px; background-color: #d32f2f; border-radius: 0 30px 30px 0; }
        .sock-top { position: absolute; top: 0; left: -5px; width: 65px; height: 30px; background-color: #f5f5f5; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .sock-heel { position: absolute; bottom: 25px; left: 0; width: 30px; height: 30px; background-color: #b71c1c; border-radius: 0 100% 0 0; }

        /* UI */
        .score-board {
            position: absolute; top: 20px; right: 20px;
            font-size: 30px; color: #ffd700; font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            z-index: 200;
        }
        .score-label { font-size: 12px; display: block; text-align: right; color: #ccc;}

        .start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 999;
        }
        .btn {
            background-color: #e63946; color: white; border: none; padding: 20px 40px;
            font-size: 24px; border-radius: 50px; font-weight: bold;
            box-shadow: 0 5px 0 #b71c1c;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #b71c1c; }

        .catch-effect {
            position: absolute; color: #ffd700; font-weight: bold; font-size: 30px;
            animation: floatUp 0.5s forwards; text-shadow: 0 0 5px orange; z-index: 150;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }
        
        .hint { margin-top: 20px; color: #ccc; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <!-- ãƒ„ãƒªãƒ¼è¡¨ç¤º -->
    <div class="top-area">
        <div class="tree-container">
            <div class="tree-wrapper">
                <div class="star"></div><div class="tree-layer layer-1"></div><div class="tree-layer layer-2"></div><div class="tree-layer layer-3"></div><div class="trunk"></div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
    <div class="game-area" id="gameArea">
        <div class="score-board">
            <span class="score-label">SCORE</span>
            <span id="scoreVal">0</span>
        </div>

        <!-- é´ä¸‹ -->
        <div class="sock-container" id="playerSock">
            <div class="sock-foot"></div>
            <div class="sock-body"></div>
            <div class="sock-heel"></div>
            <div class="sock-top"></div>
        </div>
    </div>

    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <div class="start-overlay" id="startScreen">
        <button class="btn" id="startBtn">START</button>
        <div class="hint">ç”»é¢ã‚’ãªãã£ã¦é´ä¸‹ã‚’å‹•ã‹ãã†ï¼</div>
    </div>

    <script>
        const gameArea = document.getElementById('gameArea');
        const playerSock = document.getElementById('playerSock');
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const scoreVal = document.getElementById('scoreVal');

        let isPlaying = false;
        let score = 0;
        let fallingItems = [];
        let gameInterval = null;

        // --- ã‚¿ãƒƒãƒæ“ä½œ & ãƒã‚¦ã‚¹æ“ä½œã®ä¸¡å¯¾å¿œ ---
        function moveSock(x) {
            // ç”»é¢å¤–ã«ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«åˆ¶é™
            // ç”»é¢å¹…
            const w = window.innerWidth;
            // å·¦å³ã®ä½™ç™½ã‚’å°‘ã—æŒãŸã›ã‚‹
            if (x < 0) x = 0;
            if (x > w) x = w;
            
            playerSock.style.left = x + 'px';
        }

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ (ã‚¹ãƒãƒ›ç”¨)
        gameArea.addEventListener('touchmove', (e) => {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã‚’é˜²ã
            e.preventDefault(); 
            const touch = e.touches[0];
            moveSock(touch.clientX);
        }, { passive: false });

        // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ (PCç¢ºèªç”¨)
        gameArea.addEventListener('mousemove', (e) => {
            moveSock(e.clientX);
        });


        // --- ã‚²ãƒ¼ãƒ é€²è¡Œ ---
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            startGame();
        });

        function startGame() {
            if (isPlaying) return;
            isPlaying = true;
            score = 0;
            scoreVal.innerText = score;

            gameInterval = setInterval(() => {
                spawnPresent();
            }, 1000); // 1ç§’ã”ã¨ã«ãƒ‰ãƒ­ãƒƒãƒ—
            
            // ãƒ«ãƒ¼ãƒ—ã§å½“ãŸã‚Šåˆ¤å®šãƒã‚§ãƒƒã‚¯
            requestAnimationFrame(gameLoop);
        }

        function spawnPresent() {
            const emojis = ['ğŸ', 'ğŸ§¸', 'ğŸ¬', 'ğŸ””', 'ğŸ’', 'ğŸ°'];
            const el = document.createElement('div');
            el.classList.add('present');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            
            // å‡ºç¾ä½ç½® (ç”»é¢ã®10%ã€œ90%)
            const x = 10 + Math.random() * 80;
            el.style.left = x + '%';
            el.style.top = '-10%'; // ç”»é¢ä¸Šå¤–

            document.body.appendChild(el);

            // è½ä¸‹é€Ÿåº¦ (ã‚¹ãƒãƒ›ç”»é¢ã¯ç¸¦ã«é•·ã„ã®ã§èª¿æ•´)
            // 3ç§’ã€œ5ç§’
            const duration = 3000 + Math.random() * 2000;
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ (CSS Transition)
            el.style.transition = `top ${duration}ms linear`;
            
            // å¼·åˆ¶ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå†è¨ˆç®—ã•ã›ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            requestAnimationFrame(() => {
                el.style.top = '110vh';
            });

            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã«è¿½åŠ 
            const item = {
                el: el,
                id: Date.now() + Math.random(),
                caught: false
            };
            fallingItems.push(item);

            // æƒé™¤
            setTimeout(() => {
                if(el.parentNode) el.remove();
                fallingItems = fallingItems.filter(i => i.id !== item.id);
            }, duration + 100);
        }

        // --- å½“ãŸã‚Šåˆ¤å®šãƒ«ãƒ¼ãƒ— ---
        function gameLoop() {
            if (!isPlaying) return;

            const sockRect = playerSock.getBoundingClientRect();
            // é´ä¸‹ã®ã€Œå…¥ã‚Šå£ã€ã®åˆ¤å®šã‚¨ãƒªã‚¢
            const hitZone = {
                left: sockRect.left,
                right: sockRect.right,
                top: sockRect.top,
                bottom: sockRect.top + 50
            };

            fallingItems.forEach(item => {
                if (item.caught) return;

                const itemRect = item.el.getBoundingClientRect();
                const itemX = itemRect.left + itemRect.width / 2;
                const itemY = itemRect.top + itemRect.height / 2;

                // è¡çªåˆ¤å®š
                if (
                    itemY > hitZone.top && 
                    itemY < hitZone.bottom &&
                    itemX > hitZone.left && 
                    itemX < hitZone.right
                ) {
                    catchItem(item);
                }
            });

            requestAnimationFrame(gameLoop);
        }

        function catchItem(item) {
            item.caught = true;
            item.el.remove();
            score++;
            scoreVal.innerText = score;
            
            // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            const effect = document.createElement('div');
            effect.classList.add('catch-effect');
            effect.innerText = "GET!";
            const rect = item.el.getBoundingClientRect(); // å‰Šé™¤å‰ã«ä½ç½®å–å¾—ãŒå¿…è¦ã ãŒã€CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ãªã®ã§getBoundingClientRectã¯ä¸å®‰å®šã‹ã‚‚
            // ç°¡æ˜“çš„ã«é´ä¸‹ã®ä½ç½®ã«å‡ºã™
            const sockRect = playerSock.getBoundingClientRect();
            effect.style.left = sockRect.left + 'px';
            effect.style.top = (sockRect.top - 50) + 'px';
            
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 500);
        }
    </script>
</body>
</html>
