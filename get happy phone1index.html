<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- „Çπ„Éû„ÉõÁî®„Å´ÁîªÈù¢„Çµ„Ç§„Ç∫„ÇíÂõ∫ÂÆö„Åó„ÄÅÊã°Â§ßÁ∏ÆÂ∞è„ÇíÁ¶ÅÊ≠¢„Åô„ÇãË®≠ÂÆö -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xmas Game Mobile</title>
    <style>
        body {
            margin: 0; padding: 0;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            height: 100vh; overflow: hidden; /* „Çπ„ÇØ„É≠„Éº„É´Á¶ÅÊ≠¢ */
            font-family: 'Arial Black', sans-serif;
            user-select: none; color: white;
            /* „Çπ„Éû„Éõ„Åß„ÅÆ„Çø„ÉÉ„ÉÅÊìç‰Ωú„Å´„Çà„Çã„Çπ„ÇØ„É≠„Éº„É´„ÇÑ„Ç∫„Éº„É†„ÇíÈò≤„Åê */
            touch-action: none;
            -webkit-touch-callout: none;
        }

        /* --- ‰∏äÈÉ®Ôºö„ÉÑ„É™„Éº„Ç®„É™„Ç¢ --- */
        .top-area {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 30%;
            pointer-events: none; /* „Çø„ÉÉ„ÉÅ„ÇíÈÄèÈÅé */
            z-index: 5;
        }

        .tree-container {
            position: absolute;
            top: 40%; left: 50%;
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        /* „ÉÑ„É™„ÉºÊèèÁîª */
        .star { width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent; border-bottom:20px solid #ffd700; position:absolute; top:-20px; left:50%; transform:translateX(-50%); filter:drop-shadow(0 0 10px #ffd700); }
        .tree-layer { width:0; height:0; border-left:solid transparent; border-right:solid transparent; border-bottom:solid #0f5132; position:absolute; left:50%; transform:translateX(-50%); }
        .layer-1 { border-width:0 30px 40px 30px; top:0; z-index:3; border-bottom-color:#198754; }
        .layer-2 { border-width:0 50px 60px 50px; top:25px; z-index:2; border-bottom-color:#146c43; }
        .layer-3 { border-width:0 70px 80px 70px; top:60px; z-index:1; border-bottom-color:#0f5132; }
        .trunk { width:20px; height:40px; background-color:#5d4037; position:absolute; top:140px; left:50%; transform:translateX(-50%); }
        .tree-wrapper { position:relative; width:140px; height:180px; }

        /* --- „Éó„É¨„Çº„É≥„Éà --- */
        .present {
            position: fixed;
            z-index: 50;
            font-size: 40px; /* „Çπ„Éû„Éõ„ÅßË¶ã„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´Â§ß„Åç„Åè */
            pointer-events: none;
            will-change: top;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }

        /* --- ‰∏ãÈÉ®ÔºöÊìç‰Ωú„Ç®„É™„Ç¢ --- */
        .game-area {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 70%;
            z-index: 10;
        }

        /* Ëµ§„ÅÑÈù¥‰∏ã (CSSÊèèÁîª) */
        .sock-container {
            position: absolute;
            bottom: 40px; /* Ë¶™Êåá„Å®„Åã„Å∂„Çâ„Å™„ÅÑ„Çà„ÅÜÂ∞ë„Åó‰∏ä */
            left: 50%;
            width: 70px;
            height: 110px;
            z-index: 100;
            transform: translateX(-35px); /* ‰∏≠ÂøÉÂêà„Çè„Åõ */
            pointer-events: none;
        }
        .sock-body { position: absolute; bottom: 25px; left: 0; width: 55px; height: 85px; background-color: #d32f2f; border-radius: 0 0 25px 25px; }
        .sock-foot { position: absolute; bottom: 25px; left: 25px; width: 55px; height: 45px; background-color: #d32f2f; border-radius: 0 30px 30px 0; }
        .sock-top { position: absolute; top: 0; left: -5px; width: 65px; height: 30px; background-color: #f5f5f5; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .sock-heel { position: absolute; bottom: 25px; left: 0; width: 30px; height: 30px; background-color: #b71c1c; border-radius: 0 100% 0 0; }

        /* UI */
        .score-board {
            position: absolute; top: 20px; right: 20px;
            font-size: 30px; color: #ffd700; font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            z-index: 200;
        }
        .score-label { font-size: 12px; display: block; text-align: right; color: #ccc;}

        .start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 999;
        }
        .btn {
            background-color: #e63946; color: white; border: none; padding: 20px 40px;
            font-size: 24px; border-radius: 50px; font-weight: bold;
            box-shadow: 0 5px 0 #b71c1c;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #b71c1c; }

        .catch-effect {
            position: absolute; color: #ffd700; font-weight: bold; font-size: 30px;
            animation: floatUp 0.5s forwards; text-shadow: 0 0 5px orange; z-index: 150;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }
        
        .hint { margin-top: 20px; color: #ccc; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <!-- „ÉÑ„É™„ÉºË°®Á§∫ -->
    <div class="top-area">
        <div class="tree-container">
            <div class="tree-wrapper">
                <div class="star"></div><div class="tree-layer layer-1"></div><div class="tree-layer layer-2"></div><div class="tree-layer layer-3"></div><div class="trunk"></div>
            </div>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†„Ç®„É™„Ç¢ -->
    <div class="game-area" id="gameArea">
        <div class="score-board">
            <span class="score-label">SCORE</span>
            <span id="scoreVal">0</span>
        </div>

        <!-- Èù¥‰∏ã -->
        <div class="sock-container" id="playerSock">
            <div class="sock-foot"></div>
            <div class="sock-body"></div>
            <div class="sock-heel"></div>
            <div class="sock-top"></div>
        </div>
    </div>

    <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢ -->
    <div class="start-overlay" id="startScreen">
        <button class="btn" id="startBtn">START</button>
        <div class="hint">ÁîªÈù¢„Çí„Å™„Åû„Å£„Å¶Èù¥‰∏ã„ÇíÂãï„Åã„Åù„ÅÜÔºÅ</div>
    </div>

    <script>
        const gameArea = document.getElementById('gameArea');
        const playerSock = document.getElementById('playerSock');
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const scoreVal = document.getElementById('scoreVal');

        let isPlaying = false;
        let score = 0;
        let timeLeft = 30; // 30Áßí„ÅÆÂà∂ÈôêÊôÇÈñì
        let fallingItems = [];
        let spawnTimer = null;
        let countdownTimer = null;

        // „Çø„Ç§„Éû„ÉºË°®Á§∫Áî®„ÅÆUI„ÇíHTML„Å´ËøΩÂä†„Åô„Çã„Åã„ÄÅscoreVal„ÅÆÊ®™„Å´Ë°®Á§∫„Åô„ÇãÂá¶ÁêÜ
        const timerDisplay = document.createElement('div');
        timerDisplay.style.cssText = "position:absolute; top:20px; left:20px; font-size:24px; color:#fff;";
        gameArea.appendChild(timerDisplay);

        function startGame() {
            if (isPlaying) return;
            isPlaying = true;
            score = 0;
            timeLeft = 30;
            scoreVal.innerText = score;
            startScreen.style.display = 'none';

            // „Éó„É¨„Çº„É≥„ÉàÁîüÊàê„É´„Éº„ÉóÔºàÂæê„ÄÖ„Å´Êó©„Åè„Åô„ÇãÔºâ
            let spawnRate = 1000;
            const gameStep = () => {
                if(!isPlaying) return;
                spawnPresent();
                // „Çπ„Ç≥„Ç¢„Å´Âøú„Åò„Å¶ÁîüÊàêÈÄüÂ∫¶„Çí‰∏ä„Åí„ÇãÔºàÊúÄÁü≠200msÔºâ
                spawnRate = Math.max(200, 1000 - (score * 20));
                spawnTimer = setTimeout(gameStep, spawnRate);
            };
            gameStep();

            // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Çø„Ç§„Éû„Éº
            countdownTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = `TIME: ${timeLeft}`;
                if (timeLeft <= 0) endGame();
            }, 1000);

            requestAnimationFrame(gameLoop);
        }

        function endGame() {
            isPlaying = false;
            clearInterval(countdownTimer);
            clearTimeout(spawnTimer);
            alert(`„Çø„Ç§„É†„Ç¢„ÉÉ„ÉóÔºÅ „Çπ„Ç≥„Ç¢: ${score}`);
            startScreen.style.display = 'flex';
            startBtn.innerText = "RETRY";
        }
        // --- „Çø„ÉÉ„ÉÅÊìç‰Ωú & „Éû„Ç¶„ÇπÊìç‰Ωú„ÅÆ‰∏°ÂØæÂøú ---
        function moveSock(x) {
            // ÁîªÈù¢Â§ñ„Å´„ÅØ„ÅøÂá∫„Åï„Å™„ÅÑ„Çà„ÅÜ„Å´Âà∂Èôê
            // ÁîªÈù¢ÂπÖ
            const w = window.innerWidth;
            // Â∑¶Âè≥„ÅÆ‰ΩôÁôΩ„ÇíÂ∞ë„ÅóÊåÅ„Åü„Åõ„Çã
            if (x < 0) x = 0;
            if (x > w) x = w;
            
            playerSock.style.left = x + 'px';
        }

        // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà („Çπ„Éû„ÉõÁî®)
        gameArea.addEventListener('touchmove', (e) => {
            // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÇØ„É≠„Éº„É´„Å™„Å©„ÇíÈò≤„Åê
            e.preventDefault(); 
            const touch = e.touches[0];
            moveSock(touch.clientX);
        }, { passive: false });

        // „Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà (PCÁ¢∫Ë™çÁî®)
        gameArea.addEventListener('mousemove', (e) => {
            moveSock(e.clientX);
        });


        // --- „Ç≤„Éº„É†ÈÄ≤Ë°å ---
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            startGame();
        });

        function startGame() {
            if (isPlaying) return;
            isPlaying = true;
            score = 0;
            scoreVal.innerText = score;

            gameInterval = setInterval(() => {
                spawnPresent();
            }, 1000); // 1Áßí„Åî„Å®„Å´„Éâ„É≠„ÉÉ„Éó
            
            // „É´„Éº„Éó„ÅßÂΩì„Åü„ÇäÂà§ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ
            requestAnimationFrame(gameLoop);
        }

        function spawnPresent() {
            const emojis = ['üéÅ', 'üß∏', 'üç¨', 'üîî', 'üíé', 'üç∞'];
            const el = document.createElement('div');
            el.classList.add('present');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            
            // Âá∫Áèæ‰ΩçÁΩÆ (ÁîªÈù¢„ÅÆ10%„Äú90%)
            const x = 10 + Math.random() * 80;
            el.style.left = x + '%';
            el.style.top = '-10%'; // ÁîªÈù¢‰∏äÂ§ñ

            document.body.appendChild(el);

            // ËêΩ‰∏ãÈÄüÂ∫¶ („Çπ„Éû„ÉõÁîªÈù¢„ÅØÁ∏¶„Å´Èï∑„ÅÑ„ÅÆ„ÅßË™øÊï¥)
            // 3Áßí„Äú5Áßí
            const duration = 3000 + Math.random() * 2000;
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ (CSS Transition)
            el.style.transition = `top ${duration}ms linear`;
            
            // Âº∑Âà∂„É¨„Ç§„Ç¢„Ç¶„ÉàÂÜçË®àÁÆó„Åï„Åõ„Å¶„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
            requestAnimationFrame(() => {
                el.style.top = '110vh';
            });

            // „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜ„Å´ËøΩÂä†
            const item = {
                el: el,
                id: Date.now() + Math.random(),
                caught: false
            };
            fallingItems.push(item);

            // ÊéÉÈô§
            setTimeout(() => {
                if(el.parentNode) el.remove();
                fallingItems = fallingItems.filter(i => i.id !== item.id);
            }, duration + 100);
        }

        // --- ÂΩì„Åü„ÇäÂà§ÂÆö„É´„Éº„Éó ---
        function gameLoop() {
            if (!isPlaying) return;

            const sockRect = playerSock.getBoundingClientRect();
            // Èù¥‰∏ã„ÅÆ„ÄåÂÖ•„ÇäÂè£„Äç„ÅÆÂà§ÂÆö„Ç®„É™„Ç¢
            const hitZone = {
                left: sockRect.left,
                right: sockRect.right,
                top: sockRect.top,
                bottom: sockRect.top + 50
            };

            fallingItems.forEach(item => {
                if (item.caught) return;

                const itemRect = item.el.getBoundingClientRect();
                const itemX = itemRect.left + itemRect.width / 2;
                const itemY = itemRect.top + itemRect.height / 2;

                // Ë°ùÁ™ÅÂà§ÂÆö
                if (
                    itemY > hitZone.top && 
                    itemY < hitZone.bottom &&
                    itemX > hitZone.left && 
                    itemX < hitZone.right
                ) {
                    catchItem(item);
                }
            });

            requestAnimationFrame(gameLoop);
        }

        function catchItem(item) {
            item.caught = true;
            item.el.remove();
            score++;
            scoreVal.innerText = score;
            
            // „Ç®„Éï„Çß„ÇØ„Éà
            const effect = document.createElement('div');
            effect.classList.add('catch-effect');
            effect.innerText = "GET!";
            const rect = item.el.getBoundingClientRect(); // ÂâäÈô§Ââç„Å´‰ΩçÁΩÆÂèñÂæó„ÅåÂøÖË¶Å„Å†„Åå„ÄÅCSS„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„Å™„ÅÆ„ÅßgetBoundingClientRect„ÅØ‰∏çÂÆâÂÆö„Åã„ÇÇ
            // Á∞°ÊòìÁöÑ„Å´Èù¥‰∏ã„ÅÆ‰ΩçÁΩÆ„Å´Âá∫„Åô
            const sockRect = playerSock.getBoundingClientRect();
            effect.style.left = sockRect.left + 'px';
            effect.style.top = (sockRect.top - 50) + 'px';
            
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 500);
        }
    </script>
</body>
</html>
